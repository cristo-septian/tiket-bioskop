{% extends 'base.html' %}
{% block content %}
{% if order %}
  <h1 class="text-2xl font-bold mb-4">Konfirmasi Pembayaran</h1>
  <div class="grid md:grid-cols-2 gap-6">
    <div class="p-4 rounded-2xl border border-white/10 bg-white/5">
      <div class="flex gap-4">
        <img src="{{ order.film.image_url }}" class="w-28 h-36 object-cover rounded-xl">
        <div>
          <div class="font-semibold text-lg">{{ order.film.title }}</div>
          <div class="text-sm opacity-80">Lokasi: {{ order.location }}</div>
          <div class="text-sm opacity-80">Jadwal: {{ order.showtime }}</div>
          <div class="text-sm opacity-80">Kursi: {{ order.seats_csv or '-' }}</div>
          <div class="text-sm opacity-80">Qty: {{ order.qty }}</div>
          <div class="text-sm opacity-80">Metode: {{ order.payment_method|upper }}</div>
          <div class="mt-2">Status:
            <span class="px-2 py-0.5 rounded bg-white/10">{{ order.status }}</span>
          </div>
          <div class="mt-2 text-sm">Total:
            <span class="px-2 py-0.5 rounded bg-emerald-600/30 border border-emerald-600/30">
              Rp {{ "{:,}".format(order.total_amount).replace(',', '.') }}
            </span>
          </div>
          {% if order.payment_deadline %}
          <div class="mt-1 text-xs opacity-80">Bayar sebelum: {{ order.payment_deadline.strftime("%Y-%m-%d %H:%M") }} WIB</div>
          {% endif %}
        </div>
      </div>

      {% if order.payment_method == 'dana' %}
      <div class="mt-4 rounded-xl border border-white/10 bg-white/5 p-4">
        <div class="font-semibold mb-2">Pembayaran DANA</div>
        <ol class="list-decimal ml-5 text-sm opacity-90 space-y-1">
          <li>Buka aplikasi DANA.</li>
          <li>Pilih <b>Scan</b> lalu arahkan ke QR di bawah.</li>
          <li>Pastikan nominal sesuai, lalu konfirmasi pembayaran.</li>
        </ol>
        <div class="flex flex-col items-center gap-2 mt-3">
          {% if order.payment_qr %}
            <img src="{{ order.payment_qr }}" alt="QR DANA" class="w-56 h-56 rounded-lg bg-white p-2">
          {% else %}
            <div class="text-xs opacity-70">QR belum tersedia.</div>
          {% endif %}
          <div class="text-xs opacity-75">Kode Pembayaran: <code class="px-2 py-1 rounded bg-white/10 border border-white/10">{{ order.payment_code }}</code></div>
        </div>
      </div>
      {% else %}
      <div class="mt-4 rounded-xl border border-white/10 bg-white/5 p-4">
        <div class="font-semibold mb-2">Instruksi Pembayaran ({{ order.payment_method|upper }})</div>
        <p class="text-sm opacity-90">Gunakan kode berikut saat membayar:</p>
        <div class="mt-2 text-center">
          <code class="px-3 py-2 rounded-xl bg-white/10 border border-white/10 text-lg tracking-widest">{{ order.payment_code }}</code>
        </div>
        <p class="text-xs opacity-70 mt-2">*Simulasi internal untuk demo.</p>
      </div>
      {% endif %}
    </div>

    <form method="post" class="p-4 rounded-2xl border border-white/10 bg-white/5 h-fit">
      {% if order.status == 'pending' %}
        <button name="action" value="confirm" class="w-full py-2 rounded-xl bg-emerald-600 hover:bg-emerald-700">Saya Sudah Bayar</button>
        <button name="action" value="cancel" class="w-full mt-2 py-2 rounded-xl bg-rose-600 hover:bg-rose-700">Batalkan</button>
        <p class="text-xs opacity-70 mt-3">*Tombol “Saya Sudah Bayar” akan mengonfirmasi pembayaran & mengubah status menjadi <b>paid</b>.</p>
      {% else %}
        <a href="{{ url_for('index') }}" class="w-full block text-center py-2 rounded-xl bg-white/10 hover:bg-white/20">Kembali ke Beranda</a>
      {% endif %}
    </form>
  </div>
{% else %}
  <!-- Halaman Form Beli -->
  <h1 class="text-2xl font-bold mb-4">Beli Tiket — {{ film.title }}</h1>
  <div class="grid md:grid-cols-2 gap-6">
    <div>
      <img src="{{ film.image_url }}" class="w-full h-72 object-cover rounded-2xl border border-white/10"/>
      <p class="mt-3 opacity-80">{{ film.synopsis }}</p>
      <div class="mt-2 text-sm">
        <span class="px-2 py-1 rounded-lg bg-white/10 border border-white/10">Harga: Rp {{ "{:,}".format(film.price).replace(',', '.') }}/tiket</span>
      </div>
    </div>
    <form method="post" class="space-y-3 p-6 rounded-2xl bg-white/5 border border-white/10">
      <label class="block">
        <span class="text-sm">Jumlah Tiket</span>
        <input type="number" name="qty" value="1" min="1" class="mt-1 w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10" />
      </label>
      <label class="block">
        <span class="text-sm">Nomor Kursi (pisah koma)</span>
        <input name="seats_csv" placeholder="A1, A2" class="mt-1 w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10" />
      </label>
      <label class="block">
        <span class="text-sm">Pilih Jadwal</span>
        <select name="showtime" class="mt-1 w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10">
          <option value="">-- Pilih --</option>
          {% for t in film.showtimes() %}<option value="{{ t }}">{{ t }}</option>{% endfor %}
        </select>
      </label>
      <label class="block">
        <span class="text-sm">Lokasi Bioskop</span>
        <select name="location" class="mt-1 w-full px-3 py-2 rounded-xl bg-white/10 border border-white/10">
          <option value="">-- Pilih --</option>
          {% for loc in film.locations() %}<option value="{{ loc }}">{{ loc }}</option>{% endfor %}
        </select>
      </label>
      <fieldset class="block">
        <legend class="text-sm mb-1">Metode Pembayaran</legend>
        <div class="grid grid-cols-2 gap-2 text-sm">
          {% set methods = ['dana','gopay','bank','indomaret','alfamart','qris'] %}
          {% for m in methods %}
          <label class="flex items-center gap-2 bg-white/5 border border-white/10 rounded-xl px-3 py-2">
            <input type="radio" name="payment_method" value="{{ m }}"> <span class="capitalize">{{ m }}</span>
          </label>
          {% endfor %}
        </div>
      </fieldset>
      <button class="w-full py-2 rounded-xl bg-emerald-600 hover:bg-emerald-700">Lanjutkan ke Pembayaran</button>
    </form>
  </div>
{% endif %}
{% endblock %}

